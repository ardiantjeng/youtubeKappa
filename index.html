<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.0/css/materialize.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<style type="text/css">
		.open{
			height: 80px !important;
			opacity: 1 !important;
		}

		#header {
			display:flex;
			flex-direction: column;
			align-items:center;
			padding-bottom: 0px;
		}

		#console {
			height: 0px;
			display:flex;
			justify-content:center;
			align-items:flex-end;
			opacity: 0;
			transition: .5s;
		}

		body{
			background-color: rgb(241, 241, 241);
			margin:0px 30px 15px;
		}
	</style>

	<script type="text/javascript">
		//default
		var stream = 'R1gW9R25oR8',
			chat   = 'dota2ti';
		
		stream = localStorage.getItem("stream"),
		chat   = localStorage.getItem("chat")	
		console.log('getting stored value...', stream, chat);

	</script>

</head>
<body>
	<div id="header" class="row">
		<!--OPTIONS-->
		<div id="console" class="row open">
			<div class="col s12 teal-text text-darken-3">
		        <div id="abc" class="input-field col s6">
					<select id="streamcode">
						<option value="" disabled selected>Choose stream</option>
					</select>
					<label>Youtube stream</label>
				</div>

				<div class="input-field col s6">
		          <input id="chatcode" type="text">
		          <label for="chatcode">Twitch Channel</label>
		        </div>
	        </div>
		</div>
		<!--<div class="row">
			<a id="headerbtn" class="btn-floating btn-large waves-effect waves-light"><i class="material-icons">mode_edit</i></a>
		</div>-->
	</div>

	<div class="row" style="display:flex;">
		<div class="col l9">
			<div class="video-container">
				<!--STREAM-->
				<iframe id="stream" 
						frameborder="0" 
						allowfullscreen>
				</iframe>
			</div>
		</div>
		<div class="col l3 card-panel" style=" margin:0px; flex: 1; display:flex; flex-direction: column;">
			<!--CHAT-->
			<iframe id="chat"  
					frameborder="0" 
			        scrolling="no"
			        style="flex: 1;">
			</iframe>
		</div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.0/js/materialize.min.js"></script>
	<script>

		$(document).ready(function() {
			$('select').material_select();
			$('#stream').attr('src', 'https://www.youtube.com/embed/' + stream + '?autoplay=1');
			$('#chat').attr('src', 'http://www.twitch.tv/' + chat + '/chat');
		});

		$('#streamcode').on('change', function() {
			var streamcode = $('#streamcode').val();
			if(streamcode) {
				console.log('connecting to youtube stream: ' + streamcode);
				$('#stream').attr('src', 'https://www.youtube.com/embed/' + streamcode + '?autoplay=1');
				localStorage.setItem("stream", streamcode);
			}
		});

		$('#chatcode').on('change', function() {
			var chatcode = $('#chatcode').val();
			if(chatcode) {
				console.log('connecting to twitch chat: ' + chatcode);
				$('#chat').attr('src', 'http://www.twitch.tv/' + chatcode + '/chat');
				localStorage.setItem("chat", chatcode);
			}
		});

		
		$.getJSON('https://dl.dropboxusercontent.com/u/24830786/streamlist.json', function(data) {
			console.log('getting stream list...');
			var streamlist = data;

			if(streamlist) {
				$.each(streamlist, function(key, val) {
					$('#streamcode').append($('<option>', { 
						value: val,
						text : key 
					}));
				});
			}
			$('select').material_select();
			$('#abc').children('.caret').remove();
		});
	</script>
</body>
</html>